
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Jason C Fisher</title>
    
    <meta name="author" content="Jason C Fisher">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <link rel="alternate" type="application/atom+xml" title="R Entries" href="/atom.xml" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter-2.0/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css" media="screen">
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="/assets/themes/twitter-2.0/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter-2.0/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter-2.0/css/syntax.css" rel="stylesheet" type="text/css">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/figs/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="/figs/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/figs/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/figs/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">jfisher-usgs</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="/categories.html">Categories</a></li>
              <li><a href="/archive.html">Archive</a></li>
              <li><a href="/about.html">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Jason C Fisher  <small>blog</small></h1>
</div>

<div class="row">
  <div class="span12">
    
   <!-- here add you post markup -->
   <h1><a href="/r/2012/07/03/knitr-jekyll">Blog with Knitr and Jekyll</a></h1>
   <p class="author">
    <span class="date">2012-07-03</span>
  </p>
  <div class="content">
    <p>The <a href='http://yihui.name/knitr/'>knitr</a> package provides an easy way to embed <a href='http://www.r-project.org/'>R</a> code in a <a href='http://jekyllbootstrap.com/'>Jekyll-Bootstrap</a> blog post. The only required input is an <strong>R Markdown</strong> source file. The name of the source file used to generate this post is <em>2012-07-03-knitr-jekyll.Rmd</em>, available <a href='https://github.com/jfisher-usgs/jfisher-usgs.github.com/blob/master/Rmd/2012-07-03-knitr-jekyll.Rmd'>here</a>. Steps taken to build this post are as follows:</p>

<h3 id='step_1'>Step 1</h3>

<p>Create a Jekyll-Boostrap blog if you don&#8217;t already have one. A brief tutorial on building this blog is available <a href='/lessons/2012/05/30/jekyll-build-on-windows/'>here</a>.</p>

<h3 id='step_2'>Step 2</h3>

<p>Open the R Console and process the source file:</p>
<div class='highlight'><pre><code class='r'>KnitPost <span class='o'>&lt;-</span> <span class='kr'>function</span><span class='p'>(</span>input<span class='p'>,</span> base.url <span class='o'>=</span> <span class='s'>&quot;/&quot;</span><span class='p'>)</span> <span class='p'>{</span>
    require<span class='p'>(</span>knitr<span class='p'>)</span>
    opts_knit<span class='o'>$</span>set<span class='p'>(</span>base.url <span class='o'>=</span> base.url<span class='p'>)</span>
    fig.path <span class='o'>&lt;-</span> paste0<span class='p'>(</span><span class='s'>&quot;figs/&quot;</span><span class='p'>,</span> sub<span class='p'>(</span><span class='s'>&quot;.Rmd$&quot;</span><span class='p'>,</span> <span class='s'>&quot;&quot;</span><span class='p'>,</span> basename<span class='p'>(</span>input<span class='p'>)),</span> <span class='s'>&quot;/&quot;</span><span class='p'>)</span>
    opts_chunk<span class='o'>$</span>set<span class='p'>(</span>fig.path <span class='o'>=</span> fig.path<span class='p'>)</span>
    opts_chunk<span class='o'>$</span>set<span class='p'>(</span>fig.cap <span class='o'>=</span> <span class='s'>&quot;center&quot;</span><span class='p'>)</span>
    render_jekyll<span class='p'>()</span>
    knit<span class='p'>(</span>input<span class='p'>,</span> envir <span class='o'>=</span> parent.frame<span class='p'>())</span>
<span class='p'>}</span>
KnitPost<span class='p'>(</span><span class='s'>&quot;2012-07-03-knitr-jekyll.Rmd&quot;</span><span class='p'>)</span>
</code></pre>
</div>
<h3 id='step_3'>Step 3</h3>

<p>Move the resulting image folder <em>2012-07-03-knitr-jekyll</em> and <strong>Markdown</strong> file <em>2012-07-03-knitr-jekyll.md</em> to the local <em>jfisher-usgs.github.com</em> <a href='http://git-scm.com/'>git</a> repository. The KnitPost function assumes that the image folder will be placed in a <a href='https://github.com/jfisher-usgs/jfisher-usgs.github.com/tree/master/figs'>figs</a> folder located at the root of the repository.</p>

<h3 id='step_4'>Step 4</h3>

<p>Add the following CSS code to the <em>/assets/themes/twitter-2.0/css/bootstrap.min.css</em> file to center images:</p>

<pre><code>[alt=center] {
  display: block;
  margin: auto;
}</code></pre>

<p>That&#8217;s it.</p>
<hr />
<p>Here are a few examples of embedding R code:</p>
<div class='highlight'><pre><code class='r'>summary<span class='p'>(</span>cars<span class='p'>)</span>
</code></pre>
</div><div class='highlight'><pre><code class='text'>##      speed           dist    
##  Min.   : 4.0   Min.   :  2  
##  1st Qu.:12.0   1st Qu.: 26  
##  Median :15.0   Median : 36  
##  Mean   :15.4   Mean   : 43  
##  3rd Qu.:19.0   3rd Qu.: 56  
##  Max.   :25.0   Max.   :120  
</code></pre>
</div><div class='highlight'><pre><code class='r'>par<span class='p'>(</span>mar <span class='o'>=</span> c<span class='p'>(</span><span class='m'>4</span><span class='p'>,</span> <span class='m'>4</span><span class='p'>,</span> <span class='m'>0.1</span><span class='p'>,</span> <span class='m'>0.1</span><span class='p'>),</span> omi <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>))</span>
plot<span class='p'>(</span>cars<span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-07-03-knitr-jekyll/fig1.png' /></p>

<h5 id='figure_1_caption'>Figure 1: Caption</h5>
<div class='highlight'><pre><code class='r'>par<span class='p'>(</span>mar <span class='o'>=</span> c<span class='p'>(</span><span class='m'>2.5</span><span class='p'>,</span> <span class='m'>2.5</span><span class='p'>,</span> <span class='m'>0.5</span><span class='p'>,</span> <span class='m'>0.1</span><span class='p'>),</span> omi <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>))</span>
filled.contour<span class='p'>(</span>volcano<span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-07-03-knitr-jekyll/fig2.png' /></p>

<h5 id='figure_2_caption'>Figure 2: Caption</h5>

<p>And don&#8217;t forget your session information for proper reproducible research.</p>
<div class='highlight'><pre><code class='r'>sessionInfo<span class='p'>()</span>
</code></pre>
</div><div class='highlight'><pre><code class='text'>## R version 2.15.1 (2012-06-22)
## Platform: x86_64-pc-mingw32/x64 (64-bit)
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] knitr_0.6.3
## 
## loaded via a namespace (and not attached):
## [1] digest_0.5.2   evaluate_0.4.2 formatR_0.5    plyr_1.7.1    
## [5] stringr_0.6    tools_2.15.1  
</code></pre>
</div>
  </div>

   <!-- here add you post markup -->
   <h1><a href="/r/2012/06/25/grid2polygons">Grid2Polygons</a></h1>
   <p class="author">
    <span class="date">2012-06-25</span>
  </p>
  <div class="content">
    <p>I&#8217;d like to introduce you to the <em>Grid2Polygons</em> function; an <a href='http://www.r-project.org/'>R</a> function for converting <strong>sp</strong> spatial objects from class <em>SpatialGridDataFrame</em> to <em>SpatialPolygonsDataFrame</em>. The significance of this conversion is that spatial polygons can be transformed to a different projection or datum with the <em>spTransform</em> function in package <strong>rgdal</strong>. Postscript files created with spatial polygons are reduced in size and result in a much &#8220;cleaner&#8221; version of your image. Disadvantages of the conversion include long computational times and irreversible leveling, partitioning the range of <em>z</em> values. A general explanation of the algorithm is provided <a href='http://stackoverflow.com/questions/643995/algorithm-to-merge-adjacent-rectangles-into-polygon}'>here</a>; inspiration provided <a href='http://menugget.blogspot.com/2012/04/create-polygons-from-matrix.html'>here</a>.</p>

<p>To access the function install the <a href='http://cran.r-project.org/web/packages/Grid2Polygons/index.html'>Grid2Polygons</a> package (<a href='https://github.com/jfisher-usgs/Grid2Polygons'>source</a>):</p>
<div class='highlight'><pre><code class='r'>install.packages<span class='p'>(</span><span class='s'>&quot;Grid2Polygons&quot;</span><span class='p'>)</span>
library<span class='p'>(</span>Grid2Polygons<span class='p'>)</span>
</code></pre>
</div>
<p>See help documentation for argument descriptions:</p>
<div class='highlight'><pre><code class='r'><span class='o'>?</span>Grid2Polygons
</code></pre>
</div>
<p>The following examples highlight the functions usefulness:</p>

<h2 id='example_1'>Example 1</h2>

<p>Construct a simple spatial grid data frame.</p>
<div class='highlight'><pre><code class='r'>m <span class='o'>&lt;-</span> <span class='m'>5</span>
n <span class='o'>&lt;-</span> <span class='m'>6</span>
z <span class='o'>&lt;-</span> c<span class='p'>(</span><span class='m'>1.1</span><span class='p'>,</span>  <span class='m'>1.5</span><span class='p'>,</span>  <span class='m'>4.2</span><span class='p'>,</span>  <span class='m'>4.1</span><span class='p'>,</span>  <span class='m'>4.3</span><span class='p'>,</span>  <span class='m'>4.7</span><span class='p'>,</span>
       <span class='m'>1.2</span><span class='p'>,</span>  <span class='m'>1.4</span><span class='p'>,</span>  <span class='m'>4.8</span><span class='p'>,</span>  <span class='m'>4.8</span><span class='p'>,</span>   <span class='kc'>NA</span><span class='p'>,</span>  <span class='m'>4.1</span><span class='p'>,</span>
       <span class='m'>1.7</span><span class='p'>,</span>  <span class='m'>4.2</span><span class='p'>,</span>  <span class='m'>1.4</span><span class='p'>,</span>  <span class='m'>4.8</span><span class='p'>,</span>  <span class='m'>4.0</span><span class='p'>,</span>  <span class='m'>4.4</span><span class='p'>,</span>
       <span class='m'>1.1</span><span class='p'>,</span>  <span class='m'>1.3</span><span class='p'>,</span>  <span class='m'>1.2</span><span class='p'>,</span>  <span class='m'>4.8</span><span class='p'>,</span>  <span class='m'>1.6</span><span class='p'>,</span>   <span class='kc'>NA</span><span class='p'>,</span>
       <span class='m'>3.3</span><span class='p'>,</span>  <span class='m'>2.9</span><span class='p'>,</span>   <span class='kc'>NA</span><span class='p'>,</span>  <span class='m'>4.1</span><span class='p'>,</span>  <span class='m'>1.0</span><span class='p'>,</span>  <span class='m'>4.0</span><span class='p'>)</span>
x <span class='o'>&lt;-</span> rep<span class='p'>(</span><span class='m'>0</span><span class='o'>:</span><span class='m'>6</span><span class='p'>,</span> m <span class='o'>+</span> <span class='m'>1</span><span class='p'>)</span>
y <span class='o'>&lt;-</span> rep<span class='p'>(</span><span class='m'>0</span><span class='o'>:</span><span class='m'>5</span><span class='p'>,</span> each <span class='o'>=</span> n <span class='o'>+</span> <span class='m'>1</span><span class='p'>)</span>
xc <span class='o'>&lt;-</span> c<span class='p'>(</span>rep<span class='p'>(</span>seq<span class='p'>(</span><span class='m'>0.5</span><span class='p'>,</span> <span class='m'>5.5</span><span class='p'>,</span> by <span class='o'>=</span> <span class='m'>1</span><span class='p'>),</span> m<span class='p'>))</span>
yc <span class='o'>&lt;-</span> rep<span class='p'>(</span>rev<span class='p'>(</span>seq<span class='p'>(</span><span class='m'>0.5</span><span class='p'>,</span> <span class='m'>4.5</span><span class='p'>,</span> by <span class='o'>=</span> <span class='m'>1</span><span class='p'>)),</span> each <span class='o'>=</span> n<span class='p'>)</span>
grd <span class='o'>&lt;-</span> data.frame<span class='p'>(</span>z <span class='o'>=</span> z<span class='p'>,</span> xc <span class='o'>=</span> xc<span class='p'>,</span> yc <span class='o'>=</span> yc<span class='p'>)</span>
coordinates<span class='p'>(</span>grd<span class='p'>)</span> <span class='o'>&lt;-</span> <span class='o'>~</span> xc <span class='o'>+</span> yc
gridded<span class='p'>(</span>grd<span class='p'>)</span> <span class='o'>&lt;-</span> <span class='kc'>TRUE</span>
grd <span class='o'>&lt;-</span> as<span class='p'>(</span>grd<span class='p'>,</span> <span class='s'>&quot;SpatialGridDataFrame&quot;</span><span class='p'>)</span>
</code></pre>
</div>
<p>Plot the grid using a gray scale to indicate values of <em>z</em> (<strong>fig. 1</strong>).</p>
<div class='highlight'><pre><code class='r'>image<span class='p'>(</span>grd<span class='p'>,</span> col <span class='o'>=</span> gray.colors<span class='p'>(</span><span class='m'>30</span><span class='p'>),</span> axes <span class='o'>=</span> <span class='kc'>TRUE</span><span class='p'>)</span>
grid<span class='p'>(</span>col <span class='o'>=</span> <span class='s'>&quot;black&quot;</span><span class='p'>,</span> lty <span class='o'>=</span> <span class='m'>1</span><span class='p'>)</span>
points<span class='p'>(</span>x <span class='o'>=</span> x<span class='p'>,</span> y <span class='o'>=</span> y<span class='p'>,</span> pch <span class='o'>=</span> <span class='m'>16</span><span class='p'>)</span>
text<span class='p'>(</span>cbind<span class='p'>(</span>xc<span class='p'>,</span> yc<span class='p'>),</span> labels <span class='o'>=</span> z<span class='p'>)</span>
text<span class='p'>(</span>cbind<span class='p'>(</span>x <span class='o'>=</span> x <span class='o'>+</span> <span class='m'>0.1</span><span class='p'>,</span> y <span class='o'>=</span> rev<span class='p'>(</span>y <span class='o'>+</span> <span class='m'>0.1</span><span class='p'>)),</span> labels <span class='o'>=</span> <span class='m'>1</span><span class='o'>:</span><span class='m'>42</span><span class='p'>,</span> cex <span class='o'>=</span> <span class='m'>0.6</span><span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-25-grid2polygons/fig1.png' /></p>

<h5 id='figure_1_simple_spatial_grid_data_frame'>Figure 1: Simple spatial grid data frame.</h5>

<p>Convert the grid to spatial polygons and overlay in plot (<strong>fig. 2</strong>). Leveling is specified with cut locations at 1, 2, 3, 4, and 5, and <em>z</em>-values set equal to the midpoint between breakpoints. A &#8220;winding rule&#8221; is used to determine if a polygon ring is filled (island) or is a hole in another polygon.</p>
<div class='highlight'><pre><code class='r'>plys <span class='o'>&lt;-</span> Grid2Polygons<span class='p'>(</span>grd<span class='p'>,</span> level <span class='o'>=</span> <span class='kc'>TRUE</span><span class='p'>,</span> at <span class='o'>=</span> <span class='m'>1</span><span class='o'>:</span><span class='m'>5</span><span class='p'>)</span>
cols <span class='o'>&lt;-</span> rainbow<span class='p'>(</span><span class='m'>4</span><span class='p'>,</span> alpha <span class='o'>=</span> <span class='m'>0.3</span><span class='p'>)</span>
plot<span class='p'>(</span>plys<span class='p'>,</span> col <span class='o'>=</span> cols<span class='p'>,</span> add <span class='o'>=</span> <span class='kc'>TRUE</span><span class='p'>)</span>
x <span class='o'>&lt;-</span> rep<span class='p'>(</span><span class='m'>0</span><span class='o'>:</span><span class='m'>6</span><span class='p'>,</span> m <span class='o'>+</span> <span class='m'>1</span><span class='p'>)</span>
y <span class='o'>&lt;-</span> rep<span class='p'>(</span><span class='m'>0</span><span class='o'>:</span><span class='m'>5</span><span class='p'>,</span> each <span class='o'>=</span> n <span class='o'>+</span> <span class='m'>1</span><span class='p'>)</span>
legend<span class='p'>(</span><span class='s'>&quot;top&quot;</span><span class='p'>,</span> legend <span class='o'>=</span> plys<span class='p'>[[</span><span class='m'>1</span><span class='p'>]],</span> fill <span class='o'>=</span> cols<span class='p'>,</span> bty <span class='o'>=</span> <span class='s'>&quot;n&quot;</span><span class='p'>,</span> xpd <span class='o'>=</span> <span class='kc'>TRUE</span><span class='p'>,</span> inset <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>-0.1</span><span class='p'>),</span> ncol <span class='o'>=</span> <span class='m'>4</span><span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-25-grid2polygons/fig2.png' /></p>

<h5 id='figure_2_simple_gridded_data_represented_with_spatial_polygons'>Figure 2: Simple gridded data represented with spatial polygons.</h5>

<h2 id='example_2'>Example 2</h2>

<p>Apply the conversion function to the <em>meuse</em> data set, included in the <strong>sp</strong> package. The effect of leveling is shown in <strong>figure 3</strong>.</p>
<div class='highlight'><pre><code class='r'>data<span class='p'>(</span>meuse.grid<span class='p'>)</span>
coordinates<span class='p'>(</span>meuse.grid<span class='p'>)</span> <span class='o'>&lt;-</span> <span class='o'>~</span> x <span class='o'>+</span> y
gridded<span class='p'>(</span>meuse.grid<span class='p'>)</span> <span class='o'>&lt;-</span> <span class='kc'>TRUE</span>
meuse.grid <span class='o'>&lt;-</span> as<span class='p'>(</span>meuse.grid<span class='p'>,</span> <span class='s'>&quot;SpatialGridDataFrame&quot;</span><span class='p'>)</span>
meuse.plys <span class='o'>&lt;-</span> Grid2Polygons<span class='p'>(</span>meuse.grid<span class='p'>,</span> <span class='s'>&quot;dist&quot;</span><span class='p'>,</span> level <span class='o'>=</span> <span class='kc'>FALSE</span><span class='p'>)</span>
op <span class='o'>&lt;-</span> par<span class='p'>(</span>mfrow <span class='o'>=</span> c<span class='p'>(</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>),</span> oma <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>),</span> mar <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>))</span>
z <span class='o'>&lt;-</span> meuse.plys<span class='p'>[[</span><span class='m'>1</span><span class='p'>]]</span>
col.idxs <span class='o'>&lt;-</span> findInterval<span class='p'>(</span>z<span class='p'>,</span> sort<span class='p'>(</span>unique<span class='p'>(</span>na.omit<span class='p'>(</span>z<span class='p'>))))</span>
cols <span class='o'>&lt;-</span> heat.colors<span class='p'>(</span>max<span class='p'>(</span>col.idxs<span class='p'>))[</span>col.idxs<span class='p'>]</span>
plot<span class='p'>(</span>meuse.plys<span class='p'>,</span> col <span class='o'>=</span> cols<span class='p'>)</span>
title<span class='p'>(</span><span class='s'>&quot;level = FALSE&quot;</span><span class='p'>,</span> line <span class='o'>=</span> <span class='m'>-7</span><span class='p'>)</span>
meuse.plys.lev <span class='o'>&lt;-</span> Grid2Polygons<span class='p'>(</span>meuse.grid<span class='p'>,</span> <span class='s'>&quot;dist&quot;</span><span class='p'>,</span> level <span class='o'>=</span> <span class='kc'>TRUE</span><span class='p'>)</span>
z <span class='o'>&lt;-</span> meuse.plys.lev<span class='p'>[[</span><span class='m'>1</span><span class='p'>]]</span>
col.idxs <span class='o'>&lt;-</span> findInterval<span class='p'>(</span>z<span class='p'>,</span> sort<span class='p'>(</span>unique<span class='p'>(</span>na.omit<span class='p'>(</span>z<span class='p'>))))</span>
cols <span class='o'>&lt;-</span> heat.colors<span class='p'>(</span>max<span class='p'>(</span>col.idxs<span class='p'>))[</span>col.idxs<span class='p'>]</span>
plot<span class='p'>(</span>meuse.plys.lev<span class='p'>,</span> col <span class='o'>=</span> cols<span class='p'>)</span>
title<span class='p'>(</span><span class='s'>&quot;level = TRUE&quot;</span><span class='p'>,</span> line <span class='o'>=</span> <span class='m'>-7</span><span class='p'>)</span>
par<span class='p'>(</span>op<span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-25-grid2polygons/fig3.png' /></p>

<h5 id='figure_3_distance_from_river_represented_with_spatial_polygons'>Figure 3: Distance from river represented with spatial polygons.</h5>

<h2 id='example_3'>Example 3</h2>

<p>A real-world example using topographic information on the eastern Snake River Plain; raster plot shown in <strong>figure 4</strong>.</p>
<div class='highlight'><pre><code class='r'>library<span class='p'>(</span>rgdal<span class='p'>)</span>
data<span class='p'>(</span>DEM<span class='p'>)</span>
at <span class='o'>&lt;-</span> seq<span class='p'>(</span><span class='m'>500</span><span class='p'>,</span> <span class='m'>4000</span><span class='p'>,</span> by <span class='o'>=</span> <span class='m'>250</span><span class='p'>)</span>
op <span class='o'>&lt;-</span> par<span class='p'>(</span>oma <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>),</span> mar <span class='o'>=</span> c<span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>,</span> <span class='m'>0</span><span class='p'>))</span>
image<span class='p'>(</span>DEM<span class='p'>,</span> breaks <span class='o'>=</span> at<span class='p'>,</span> col <span class='o'>=</span> terrain.colors<span class='p'>(</span>length<span class='p'>(</span>at<span class='p'>)</span> <span class='o'>-</span> <span class='m'>1</span><span class='p'>))</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-25-grid2polygons/fig4.png' /></p>

<h5 id='figure_4_topographic_information_represented_with_a_raster_image'>Figure 4: Topographic information represented with a raster image.</h5>

<p>Convert the grid to spatial polygons (<strong>fig. 5</strong>). The conversion took 22.7 seconds on my machine. The size of the postscript file created from the polygon image (1.89 MB) is 82.6 percent smaller than the size of the raster image file (10.86 MB).</p>
<div class='highlight'><pre><code class='r'>dem.plys <span class='o'>&lt;-</span> Grid2Polygons<span class='p'>(</span>DEM<span class='p'>,</span> level <span class='o'>=</span> <span class='kc'>TRUE</span><span class='p'>,</span> at <span class='o'>=</span> at<span class='p'>)</span>
z <span class='o'>&lt;-</span> dem.plys<span class='p'>[[</span><span class='m'>1</span><span class='p'>]]</span>
col.idxs <span class='o'>&lt;-</span> findInterval<span class='p'>(</span>z<span class='p'>,</span> at<span class='p'>)</span>
cols <span class='o'>&lt;-</span> terrain.colors<span class='p'>(</span>length<span class='p'>(</span>at<span class='p'>)</span> <span class='o'>-</span> <span class='m'>1</span><span class='p'>)[</span>col.idxs<span class='p'>]</span>
plot<span class='p'>(</span>dem.plys<span class='p'>,</span> border <span class='o'>=</span> <span class='s'>&quot;transparent&quot;</span><span class='p'>,</span> col <span class='o'>=</span> cols<span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-25-grid2polygons/fig5.png' /></p>

<h5 id='figure_5_topographic_information_represented_with_spatial_polygons'>Figure 5: Topographic information represented with spatial polygons.</h5>

<p>Finally, transform the projection of the spatial polygons object (1.5 seconds) and replot (<strong>fig. 6</strong>).</p>
<div class='highlight'><pre><code class='r'>dem.plys.trans <span class='o'>&lt;-</span> rgdal<span class='o'>::</span>spTransform<span class='p'>(</span>dem.plys<span class='p'>,</span> CRS <span class='o'>=</span> CRS<span class='p'>(</span><span class='s'>&quot;+proj=eqc&quot;</span><span class='p'>))</span>
plot<span class='p'>(</span>dem.plys.trans<span class='p'>,</span> border <span class='o'>=</span> <span class='s'>&quot;transparent&quot;</span><span class='p'>,</span> col <span class='o'>=</span> cols<span class='p'>)</span>
par<span class='p'>(</span>op<span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-25-grid2polygons/fig6.png' /></p>

<h5 id='figure_6_topographic_information_represented_with_spatial_polygons_and_new_projection'>Figure 6: Topographic information represented with spatial polygons and new projection.</h5>
  </div>

   <!-- here add you post markup -->
   <h1><a href="/r/2012/06/01/color-tools">Color Tools</a></h1>
   <p class="author">
    <span class="date">2012-06-01</span>
  </p>
  <div class="content">
    <p>Colors are mysterious business and choosing the right color or color palette for an <a href='http://www.r-project.org/'>R</a> graphics can sometimes be a chore. To alleviate this burden, I present two functions for choosing color values.</p>

<p>To access these functions install the <a href='http://cran.r-project.org/web/packages/RSurvey/'>RSurvey</a> and <a href='http://cran.r-project.org/web/packages/dichromat/'>dichromat</a> packages:</p>
<div class='highlight'><pre><code class='r'>install.packages<span class='p'>(</span>c<span class='p'>(</span><span class='s'>&quot;RSurvey&quot;</span><span class='p'>,</span> <span class='s'>&quot;dichromat&quot;</span><span class='p'>))</span>
library<span class='p'>(</span>RSurvey<span class='p'>)</span>
</code></pre>
</div>
<h2 id='choose_color'>Choose Color</h2>

<p>The first function, <em>ChooseColor</em> (<a href='https://github.com/jfisher-usgs/RSurvey/blob/master/R/ChooseColor.R'>source</a>), calls upon a graphical user interface (GUI) for choosing a color in the <a href='http://en.wikipedia.org/wiki/HSL_and_HSV'>HSV</a> color space (<strong>fig. 1</strong>).</p>
<div class='highlight'><pre><code class='r'>col <span class='o'>&lt;-</span> ChooseColor<span class='p'>(</span>col <span class='o'>=</span> <span class='s'>&quot;#669933&quot;</span><span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-01-color-tools/fig1.png' /></p>

<h5 id='figure_1_a_screenshot_of_the_hsv_color_tool'>Figure 1: A screenshot of the HSV color tool.</h5>

<h2 id='choose_color_palette'>Choose Color Palette</h2>

<p>The second function, <em>ChoosePalette</em> (<a href='https://github.com/jfisher-usgs/RSurvey/blob/master/R/ChoosePalette.R'>source</a>), calls upon a GUI for choosing a color palette in the HCL (Hue, Chroma, and Luminance) color space (<strong>fig. 2</strong>).</p>
<div class='highlight'><pre><code class='r'>pal <span class='o'>&lt;-</span> ChoosePalette<span class='p'>(</span>terrain_hcl<span class='p'>)</span>
</code></pre>
</div>
<p><img alt='center' src='/figs/2012-06-01-color-tools/fig2.png' /></p>

<h5 id='figure_2_a_screenshot_of_the_hcl_color_palette_tool'>Figure 2: A screenshot of the HCL color palette tool.</h5>

<p>An example graphic accompanies the GUI and may be used to evaluate the robustness of individual color schemes (<strong>fig. 3</strong>).</p>

<p><img alt='center' src='/figs/2012-06-01-color-tools/fig3.png' /></p>

<h5 id='figure_3_example_graphic_based_on_selected_color_palette'>Figure 3: Example graphic based on selected color palette.</h5>

<p>The <em>ChoosePalette</em> function may eventually reside in the <strong>colorspace</strong> package.</p>
  </div>


<!-- Pagination links -->
<div class="pagination pagination-centered">
  <ul>
  
    <li class="prev disabled"><a>Prev</a></li>
  
  
    <li class="next"><a href="/page2" title="Next page">Next</a></li>
  
  </ul>
</div>

  </div>
</div>


      </div>

      <footer>
      </footer>

    </div> <!-- /container -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/twitter-2.0/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/twitter-2.0/js/bootstrap.min.js"></script>
    
  </body>
</html>

